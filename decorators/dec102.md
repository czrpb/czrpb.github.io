---
marp: true
size: 16:9
theme: uncover
class: invert
paginate: true
math: katex
style: |
  @import 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/fontawesome.min.css';
  @import 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/solid.min.css';

  a {
    font-size: 12pt;
  }

  .small-size {
    font-size: 8pt;
    margin: 0px;
    padding: 0px;
  }

  ul li ul li {
    font-size: 16pt;
  }

  footer {
    left: auto;
    right: auto;
    top: auto;
    bottom: auto;

    right: 20px;
    top: 20px;
  }
---

# Decorators 102

## Dynamic Decorators

Quentin Crain

---

## Agenda

- 2 Concepts Review
- Basic Decorator Review
- Decorator Arguments
- Wrapped Function's Arguments
- Icons
    - <span class="fa-solid fa-brain"> More Education!</span>
    - <span class="fa-solid fa-laptop-code"> Practical Learning!</span>
    - <span class="fa-solid fa-virus-covid"> Bug!</span>

---

### 2 Concepts Review

<table width="100%">
<tr><td width="50%">

```python
def div_by(x):
    def wrapper(num):
        return num / x
    return wrapper
    
div_by_2 = div_by(2)
div_by_5 = div_by(5)
div_by_2(div_by_5(100))
10.0
div_by_0 = div_by(0)
div_by_0(4)
Traceback (most recent call last):
  File "<python-input-10>", line 1, in <module>
    div_by_0(4)
    ~~~~~~~~^^^
  File "<python-input-4>", line 3, in wrapper
    return num / x
           ~~~~^~~
ZeroDivisionError: division by zero
```

</td><td>

- 1st Class
- Scopes & Closures

</td></tr>
</table>

<a class="fa-solid fa-brain" href="https://www.cs.cmu.edu/~crary/819-f09/Strachey67.pdf">Fundamental Concepts in Programming Languages; Christopher Strachey; 1967</a>

---

### Basic Decorator Review

<table width="100%" style="font-size: 22pt;">
<tr><td colspan="2">

```python
from random import randint

def div_by_2(fn):
    def wrapper():
        return fn() / 2
    return wrapper
```

</td></tr>
<tr><td width="50%" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

Wrap a function:

```python
def random():
    return randint(0, 10)
random = div_by_2(random)

random()
```

</td><td width="50%" data-marpit-fragment="2" data-bespoke-marp-fragment="inactive">

Decorator Syntax:

```python
@div_by_2
def random():
    return randint(0, 10)

random()
```

</td></tr>
</table>

---

### `div_by` as Decorator

<table width="100%" style="font-size: 24pt;">
<tr><td width="50%">

We want to `div_by` any integer.

```python
from random import randint

def div_by_2(fn):
    def wrapper():
        return fn() / 2
    return wrapper

@div_by_2
def random():
    return randint(0, 10)

random()
```

</td><td data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
from random import randint

def div_by(fn, x=2):
    def wrapper():
        return fn() / x
    return wrapper

@div_by
def random():
    return randint(0, 10)

random()
```

Does this work?

</td></tr>
</table>

---

### Oh no!

<table width="100%" style="font-size: 18pt;">
<tr><td colspan="2">

```python
from random import randint

def div_by(fn, x=2):
    def wrapper():
        return fn() / x
    return wrapper

@div_by(5)
def random():
    return randint(0, 10)
```

</td></tr>
<tr><td width="50%" data-marpit-fragment="2" data-bespoke-marp-fragment="inactive">

`random = div_by(5)(random)`

```python
@div_by(5)
def random():
    return randint(0, 10)

Traceback (most recent call last):
  File "<python-input-1>", line 1, in <module>
    @div_by(5)
     ~~~~~~^^^
TypeError: div_by.<locals>.wrapper() takes
0 positional arguments but 1 was given
```

</td><td width="50%" data-marpit-fragment="2" data-bespoke-marp-fragment="inactive">

`random = div_by(x=5)(random)`

```python
@div_by(x=5)
def random():
    return randint(0, 10)

Traceback (most recent call last):
  File "<python-input-2>", line 1, in <module>
    @div_by(x=5)
     ~~~~~~^^^^^
TypeError: div_by() missing 1 required
positional argument: 'fn'
```

</td></tr>
</table>

---

### Decorators with Arguments

This is the key slide!!

<table width="100%" style="font-size: 22pt;">
<tr><td width="50%">

```python
random = div_by(2)(random)
```

What should `div_by` return?
What should **that** return?

</td><td width="50%" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
from random import randint

def div_by(x):
    def the_decorator(fn):
        def wrapper():
            return fn() / x
        return wrapper
    return the_decorator

@div_by(2)
def random():
    return randint(0, 10)

random()
```

</td></tr>
</table>

---

### Wrapped Function's Arguments

<table width="100%" style="font-size: 22pt;">
<tr><td width="50%">

What is wrong?

```python
from random import randint

def div_by(x):
    def the_decorator(fn):
        def wrapper():
            return fn() / x
        return wrapper
    return the_decorator

@div_by(2)
def random(start=0, end=10):
    return randint(start, end)
    
random()
```

</td><td width="50%" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
>>> random()
3.5

>>> random(10, 20)
Traceback (most recent call last):
  File "<python-input-5>", line 1, in <module>
    random(10, 20)
    ~~~~~~^^^^^^^^
TypeError:
div_by.<locals>.the_decorator.<locals>.wrapper()
takes 0 positional arguments but 2 were given
```

</td></tr>
</table>

---

### Wrapped Function's Arguments

<table width="100%" style="font-size: 22pt;">
<tr><td width="50%">

What is **still** wrong?

```python
from random import randint

def div_by(x):
    def the_decorator(fn):
        def wrapper(start, end):
            return fn(start, end) / x
        return wrapper
    return the_decorator

@div_by(2)
def random(start=0, end=10):
    return randint(start, end)

random()
```

</td><td width="50%" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
>>> random(10, 20)
8.5

>>> random()
Traceback (most recent call last):
  File "<python-input-8>", line 1, in <module>
    random()
    ~~~~~~^^
TypeError:
div_by.<locals>.the_decorator.<locals>.wrapper()
missing 2 required positional arguments:
'start' and 'end'
```

</td></tr>
</table>

---

### Wrapped Function's Arguments

<table width="100%" style="font-size: 22pt;">
<tr><td width="50%">

**No!** Why?

```python
from random import randint

def div_by(x):
    def the_decorator(fn):
        def wrapper(start=0, end=10):
            return fn(start, end) / x
        return wrapper
    return the_decorator

@div_by(2)
def random(start=0, end=10):
    return randint(start, end)

random()
```

</td><td width="50%" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
from random import randint

def div_by(x):
    def the_decorator(fn):
        def wrapper(*args, **kwargs):
            return fn(*args, **kwargs) / x
        return wrapper
    return the_decorator

@div_by(2)
def random(start=0, end=10):
    return randint(start, end)

@div_by(25)
def change_in_quarters(ones, tens=0, twenties=0):
    return (twenties*20 + tens*10 + ones) * 100
    
random(1000, 2000), change_in_quarters(1, 2, 3)
```

**YES!!**

</td></tr>
</table>

---

# Python's Decorators

<table width="100%" style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

```python
def <DECORATOR>(fn):
    def wrapper(*args, **kwargs):
	    # Code that uses `fn`
	    # at some point.
	return wrapper
```

</td><td width="50%" style="vertical-align: top;">

```python
def <DECORATOR-CLOSURE>(<ARGS>):
    def <DECORATOR>(fn):
        def wrapper(*args, **kwargs):
            # Code that uses `fn`
            # at some point.
        return wrapper
    return <DECORATOR>
```

</td></tr>

<tr><td style="vertical-align: top;">

```python
@<DECORATOR>
<SOME-FUNCTION>
```

</td><td>

```python
@<DECORATOR>(<ARGS>)
<SOME-FUNCTION>
```

</td></tr>
</table>

---

# L A B S

---

### Lab 1: Function Timing

---

### Lab 2: Type Checking

---

# E N D

---
