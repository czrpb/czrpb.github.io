---
marp: true
size: 16:9
theme: uncover
class: invert
paginate: true
math: katex
style: |
  @import 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/fontawesome.min.css';
  @import 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/solid.min.css';

  a {
    font-size: 13pt;
  }

  table {
    margin: 0 25px 25px 15px;
  }
  
  tbody {
    width: 100%;
  }
  
  .my-small-size {
    font-size: 8pt;
    margin: 0px;
    padding: 0px;
  }

  .my-medium-size {
    font-size: 12pt;
    margin: 0px;
    padding: 0px;
  }

  ul li ul li {
    font-size: 16pt;
  }

  footer {
    left: auto;
    right: auto;
    top: auto;
    bottom: auto;

    right: 20px;
    top: 20px;
  }
---

# Decorators 101

## What is a Function?

Quentin Crain

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>

---

## Agenda

- Function Foundations
  - Functions & `def`
  - Functions in Functions
  - Functions as Vaules

- Decorator Foundations
  - Definition
  - Building Up
  - Arrived!

- Bonus / Random
  - How was this presentation created? **[MARP](https://marp.app/)**
  - <span class="fa-solid fa-brain"> More Education!</span>
  - <span class="fa-solid fa-laptop-code"> Practical Learning!</span>

---

### Foundations: Functions & `def`

<table width="100%" style="font-size: 22pt;">
<tr><td>

<div class="mermaid">
block
  columns 3
  blockArrowId1<["POSITIONAL\nARGS"]>(down)
  blockArrowId2<["VARIABLE\nARGS"]>(down)
  blockArrowId3<["KEYWWORD\nARGS"]>(down)
  fn["F U N C T I O N\n\nC O D E"]:3
  blockArrowId4<["OUTPUT"]>(down):3
</div>

</td><td>

```python
def <NAME>(<P-ARGS>, *<V-ARGS>, **<KW-ARGS>):

    <CODE>

    return <VALUE>
```

</td></tr>
</table>

---

### Foundations: Functions as Vaules

<table style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

A function:

- Is a thing/type/object just like any other: `int`, `str`, `class <OBJ>`
- Is referenced by a name: `def <NAME>`

</td><td style="vertical-align: top;">

Thus, passed like any other type:

```python
def add1(x):
    return x+1
    
def add2(x):
    return add1(add1(x))

def apply(func, x):
    return func(x)
    
>>> apply(add1, 7)
8
>>> apply(add2, 7)
9
>>> apply(add1, apply(add1, 7))
9
```

</td></tr>
</table>

<span  class="fa-solid fa-brain my-medium-size">
<a href="https://www.cs.cmu.edu/~crary/819-f09/Strachey67.pdf">1st Class Citizen / Object</a>
</span>

---

### Decorator: Definition

To add behavior to an existing function without changing its implementation.

<span class="fa-solid fa-brain my-medium-size">
<a href="https://en.wikipedia.org/wiki/Decorator_pattern">Wikipedia</a>
|
<a href="https://www.geeksforgeeks.org/system-design/decorator-pattern/">Geeks for Geeks</a>
</span>

---

### Decorator: Building Up

<!-- Fails when 2nd argument is `0`. -->
<!--
  Not really a decorator since it doesnt change
  the behavior of the decorated function.
-->

<table width="100%;" style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

```python
def x_div_y(x, y):
   return x / y
```

How might this fail?

</td><td  style="vertical-align: top;" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
def raise_when_2nd_arg_is_0(p1, p2):
   if p2 == 0:
      raise RuntimeError(
         "0 is an invalid argument"
         " to the 2nd parameter."
      )
   return x_div_y(p1, p2)
```

Is this a decorator?

</td></tr>
</table>

---

### Decorator: Building Up cont.

<!--
Traceback (most recent call last):
  File "<python-input-1>", line 1, in <module>
    x_div_y(1, 5)
    ~~~~~~~^^^^^^
  File "<python-input-0>", line 10, in raise_when_2nd_arg_is_0
    return x_div_y(p1, p2)
  File "<python-input-0>", line 10, in raise_when_2nd_arg_is_0
    return x_div_y(p1, p2)
  File "<python-input-0>", line 10, in raise_when_2nd_arg_is_0
    return x_div_y(p1, p2)
  [Previous line repeated 988 more times]
RecursionError: maximum recursion depth exceeded
-->

<table width="100%;" style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

```python
def x_div_y(x, y):
   return x / y
   
def raise_when_2nd_arg_is_0(p1, p2):
   if p2 == 0:
      raise RuntimeError(
         "0 is an invalid argument"
         " to the 2nd parameter."
      )
   return x_div_y(p1, p2)
   
x_div_y = raise_when_2nd_arg_is_0
```

How DOES this fail?

</td><td data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
def x_div_y(x, y):
   return x / y
   
def raise_when_2nd_arg_is_0(p1, p2, fn=x_div_y):
   if p2 == 0:
      raise RuntimeError(
         "0 is an invalid argument"
         " to the 2nd parameter."
      )
   return fn(p1, p2)
   
x_div_y = raise_when_2nd_arg_is_0
```

<b>We have decorated<sup>*</sup> `x_div_y`!</b>

</td></tr>
</table>

---

### Decorator: Arrived!!

<!-- But we want a decorator to be able to decorate any function. -->

**This is the key slide!!**

<table width="100%;" style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

```python
def x_div_y(x, y):
   return x / y
   
def raise_when_2nd_arg_is_0(p1, p2, fn=x_div_y):
   if p2 == 0:
      raise RuntimeError(
         "0 is an invalid argument"
         " to the 2nd parameter."
      )
   return fn(p1, p2)
   
x_div_y = raise_when_2nd_arg_is_0
```

But we want to be able to decorate any function.

</td><td>

<pre style="my-medium-size" data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">x_div_y = raise_when_2nd_arg_is_0(x_div_y)</pre>

<span data-marpit-fragment="2" data-bespoke-marp-fragment="inactive">

```python
def x_div_y(x, y):
   return x / y
   
def raise_when_2nd_arg_is_0(fn):
   def wrapper(p1, p2):
      if p2 == 0:
         raise RuntimeError(
            "0 is an invalid argument"
            " to the 2nd parameter."
         )
      return fn(p1, p2)
   return wrapper
   
x_div_y = raise_when_2nd_arg_is_0(x_div_y)
```

<span  class="fa-solid fa-brain my-medium-size">
<a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">Closures</a>
</span>

</span>

</td></tr>
</table>

---

### Decorator: Arrived cont.

<table width="100%;" style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

```python
def x_div_y(x, y):
   return x / y
   
def raise_when_2nd_arg_is_0(fn):
   def wrapper(p1, p2):
      if p2 == 0:
         raise RuntimeError(
            "0 is an invalid argument"
            " to the 2nd parameter."
         )
      return fn(p1, p2)
   return wrapper
   
x_div_y = raise_when_2nd_arg_is_0(x_div_y)
```

But this isn't Python's decorator syntax ...

</td><td data-marpit-fragment="1" data-bespoke-marp-fragment="inactive">

```python
def raise_when_2nd_arg_is_0(fn):
   def wrapper(p1, p2):
      if p2 == 0:
         raise RuntimeError(
            "0 is an invalid argument"
            " to the 2nd parameter."
         )
      return fn(p1, p2)
   return wrapper

@raise_when_2nd_arg_is_0
def x_div_y(x, y):
   return x / y
   
@raise_when_2nd_arg_is_0
def list_with_item_repeated(item, count):
   return [item] * count
```

`@` is just syntaxic sugar.

</td></tr>
</table>

---

# E N D

<table width="100%;" style="font-size: 22pt;">
<tr><td width="50%" style="vertical-align: top;">

```python
>>> x_div_y(1, 4)
0.25

>>> x_div_y(1, 0)
Traceback (most recent call last):
  File "<python-input-5>", line 1, in <module>
    x_div_y(1, 0)
    ~~~~~~~^^^^^^
  File "<python-input-0>", line 4, in wrapper
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: 0 is an invalid argument to the 2nd parameter.
```

</td><td>

```python
>>> list_with_item_repeated("A", 4)
['A', 'A', 'A', 'A']

>>> list_with_item_repeated("A", 0)
Traceback (most recent call last):
  File "<python-input-3>", line 1, in <module>
    list_with_item_repeated("A", 0)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "<python-input-0>", line 4, in wrapper
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: 0 is an invalid argument to the 2nd parameter.
```

</td></tr>
</table>
